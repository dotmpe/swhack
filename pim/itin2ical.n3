@prefix dc: <http://purl.org/dc/elements/1.1/> .

<> dc:description """
rules to map from travel itinerary vocabulary
to iCalendar vocabulary.
$Id$
""";
    dc:source <http://www.ietf.org/rfc/rfc2445.txt> ;
    dc:relation <ical>, <ical.n3>, <ical.rdf>, <toIcal.py>, <ical2rdf.pl>.

@prefix r: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix dt: <http://www.w3.org/2001/XMLSchema#> .

@prefix log: <http://www.w3.org/2000/10/swap/log#>.
@prefix str: <http://www.w3.org/2000/10/swap/string#>.

@prefix cal: <http://www.w3.org/2002/12/cal/ical#>.
@prefix t:   <http://www.w3.org/2000/10/swap/pim/travelTerms#> .

@prefix k: <http://opencyc.sourceforge.net/daml/cyc.daml#>.

@prefix :   <itin2ical#>.
@prefix ic: <itin2ical#>.

this log:forAll :FLT, :CARRIER_NAME, :NUM, :SUM,
    :YYMMDD, :YYMMDD2, :HH_MM, :HH_MM2, :DTSTART, :DTEND, :TZ, :TZ2,
    :WHERE, :FROM_NAME, :TO_NAME, :UID.

# airports with the same nameString have the same timezone
{ :WHERE a k:Airport-Physical;
    k:nameString [
      is k:nameString of [ a k:Airport-Physical; :timeZone :TZ ] ] }
  log:implies { :WHERE :timeZone :TZ }.
#hmm... someplace to scrape these from?

@prefix a: <http://www.daml.org/cgi-bin/airport?>. #hmm... ?MCI is a document *and* an airport?
@prefix chi: <http://www.w3.org/2002/12/cal/tzd/America/Chicago#>.
@prefix ny: <http://www.w3.org/2002/12/cal/tzd/America/New_York#>.
@prefix la: <http://www.w3.org/2002/12/cal/tzd/America/Los_Angeles#>.
@prefix den: <http://www.w3.org/2002/12/cal/tzd/America/Denver#>.
@prefix paris: <http://www.w3.org/2002/12/cal/tzd/Europe/Paris#>.
@prefix london: <http://www.w3.org/2002/12/cal/tzd/Europe/London#>.
@prefix zurich: <http://www.w3.org/2002/12/cal/tzd/Europe/Zurich#>.
@prefix budapest: <http://www.w3.org/2002/12/cal/tzd/Europe/Budapest#>.


a:MCI a k:Airport-Physical;
  k:nameString "KANSAS CITY INTL";
  :timeZone chi:tz.
a:STL a k:Airport-Physical;
  k:nameString "ST LOUIS INTL";
  :timeZone chi:tz.
a:ORD a k:Airport-Physical;
 k:nameString "CHICAGO OHARE";
 :timeZone chi:tz.
a:DFW a k:Airport-Physical;
  k:nameString "DALLAS FT WORTH";
 :timeZone chi:tz.
a:EWR a k:Airport-Physical;
  k:nameString "NEWARK";
  :timeZone ny:tz.
a:BOS a k:Airport-Physical;
  k:nameString "BOSTON";
  :timeZone ny:tz.
a:DCA a k:Airport-Physical;
  k:nameString "WASHINGTON REAGAN";
  :timeZone ny:tz.
a:NCE a k:Airport-Physical;
  k:nameString "NICE";
  :timeZone :ParisTime.
a:LHR a k:Airport-Physical;
  k:nameString "LONDON HEATHROW";
  :timeZone london:tz.
a:SFO a k:Airport-Physical;
  k:nameString "SAN FRANCISCO";
  :timeZone la:tz.
a:CDG a k:Airport-Physical;
  k:nameString "PARIS DE GAULLE";
  :timeZone paris:tz.
a:FCO a k:Airport-Physical;
  k:nameString "ROME FIUMICINO";
  :timeZone paris:tz. #@@ is that right?
a:AHO a k:Airport-Physical;
  k:nameString "ALGHERO";
  :timeZone  paris:tz. #@@ is that right?
a:PIT a k:Airport-Physical;
  k:nameString "PITTSBURGH";
  :timeZone ny:tz.
a:YMX a k:Airport-Physical;
  k:nameString "MONTREAL DORVALQC";
  :timeZone ny:tz.
a:YVR a k:Airport-Physical;
  k:nameString "VANCOUVER BC";
  :timeZone la:tz.
a:SNA a k:Airport-Physical;
  k:nameString "JOHN WAYNE INTL";
  :timeZone la:tz.
a:LAX a k:Airport-Physical;
  :timeZone la:tz.
a:LGA a k:Airport-Physical;
  :timeZone ny:tz.
a:JFK a k:Airport-Physical;
  :timeZone ny:tz.
a:DEN a k:Airport-Physical;
  :timeZone den:tz.
a:ZRH a k:Airport-Physical;
  :timeZone zurich:tz.
a:BUD a k:Airport-Physical;
  :timeZone budapest:tz.

{ ?DOC a k:ItineraryDocument } => { ?DOC a cal:Vcalendar }.
{ ?DOC a k:ItineraryDocument;
    k:containsInformationAbout-Focally ?TRIP.
  ?TRIP k:subEvents ?E.
  ?E a cal:Vevent } => { ?DOC cal:component ?E }.

{ :FLT
    k:startingDate [ dt:date :YYMMDD];
    k:endingDate [ dt:date :YYMMDD2];
    t:departureTime :HH_MM;
    k:fromLocation [ :timeZone [ cal:tzid :TZ] ];
    t:arrivalTime :HH_MM2;
    k:toLocation [ :timeZone [ cal:tzid :TZ2] ].
  :DTSTART is str:concatenation of
    (:YYMMDD "T" :HH_MM ":00"). #@@ extra punct in dates
  :DTEND is str:concatenation of
    (:YYMMDD2 "T" :HH_MM2 ":00").

  ( :FLT!log:rawUri "@uri-2-mid.w3.org") str:concatenation :UID. #@@hmm... kludge?
}
 log:implies {
  :FLT a cal:Vevent;
    cal:uid :UID;
    cal:dtstart [ cal:tzid :TZ; cal:dateTime :DTSTART ];
    cal:dtend [ cal:tzid :TZ2; cal:dateTime :DTEND ].
}.


{ :FLT
    t:carrier [ k:nameOfAgent :CARRIER_NAME ];
    t:flightNumber :NUM;
    k:fromLocation [ k:nameString :FROM_NAME; ];
    k:toLocation [ k:nameString :TO_NAME; ].
  :SUM is str:concatenation of
    (:CARRIER_NAME " #" :NUM " from " :FROM_NAME " to " :TO_NAME).
}
 log:implies {
  :FLT cal:summary :SUM.
}.


# Timezone stuff transcribed from an evolution calendar...
# original source seems to be...

<> dc:source [ = <ftp://elsie.nci.nih.gov/pub/>;
  dc:creator "Olson, A.D., et al"; #@@ lazy...
  dc:title "Time zone code and data";
  dc:description "updated periodically" ].


# @@hmm... use a rule instead?
@prefix zurich: <http://www.w3.org/2002/12/cal/tzd/Europe/Zurich#>.

chi:tz a cal:Vtimezone;
  cal:tzid "/softwarestudio.org/Olson_20011030_5/America/Chicago".

ny:tz a cal:Vtimezone;
  cal:tzid "/softwarestudio.org/Olson_20011030_5/America/New_York".

paris:tz a cal:Vtimezone;
  cal:tzid "/softwarestudio.org/Olson_20011030_5/Europe/Paris".

london:tz a cal:Vtimezone;
  cal:tzid "/softwarestudio.org/Olson_20011030_5/Europe/London".

la:tz a cal:Vtimezone;
  cal:tzid "/softwarestudio.org/Olson_20011030_5/America/Los_Angeles".

den:tz a cal:Vtimezone;
  cal:tzid "/softwarestudio.org/Olson_20011030_5/America/Denver".

zurich:tz a cal:Vtimezone;
  cal:tzid "/softwarestudio.org/Olson_20011030_5/Europe/Zurich".

budapest:tz a cal:Vtimezone;
  cal:tzid "/softwarestudio.org/Olson_20011030_5/Europe/Budapest".

