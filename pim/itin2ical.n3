@prefix dc: <http://purl.org/dc/elements/1.1/> .

<> dc:description """
rules to map from travel itinerary vocabulary
to iCalendar vocabulary.
$Id$
""";
    dc:source <http://www.ietf.org/rfc/rfc2445.txt> ;
    dc:relation <http://www.w3.org/2002/12/cal/ical>, <toIcal.py>,
	<http://www.w3.org/2002/12/cal/fromIcal.py>.

@prefix r: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix dt: <http://www.w3.org/2001/XMLSchema#> .

@prefix log: <http://www.w3.org/2000/10/swap/log#>.
@prefix str: <http://www.w3.org/2000/10/swap/string#>.

@prefix cal: <http://www.w3.org/2002/12/cal/ical#>.
@prefix t:   <http://www.w3.org/2000/10/swap/pim/travelTerms#> .

@prefix k: <http://opencyc.sourceforge.net/daml/cyc.daml#>.

@prefix :   <itin2ical#>.
@prefix ic: <itin2ical#>.

@prefix a: <http://www.daml.org/cgi-bin/airport?>. #hmm... ?MCI is a document *and* an airport?
@prefix chi: <http://www.w3.org/2002/12/cal/tzd/America/Chicago#>.
@prefix ny: <http://www.w3.org/2002/12/cal/tzd/America/New_York#>.
@prefix la: <http://www.w3.org/2002/12/cal/tzd/America/Los_Angeles#>.
@prefix den: <http://www.w3.org/2002/12/cal/tzd/America/Denver#>.
@prefix paris: <http://www.w3.org/2002/12/cal/tzd/Europe/Paris#>.
@prefix london: <http://www.w3.org/2002/12/cal/tzd/Europe/London#>.
@prefix zurich: <http://www.w3.org/2002/12/cal/tzd/Europe/Zurich#>.
@prefix budapest: <http://www.w3.org/2002/12/cal/tzd/Europe/Budapest#>.
@prefix ams: <http://www.w3.org/2002/12/cal/tzd/Europe/Amsterdam#>.


# use cityLookup.n3 to map IATA codes to timezones; we no longer keep
# these here...
# a:MCI a k:Airport-Physical;
#   k:nameString "KANSAS CITY INTL";
#   :timeZone chi:tz.

{ ?DOC a k:ItineraryDocument } => { ?DOC a cal:Vcalendar }.
{ ?DOC a k:ItineraryDocument;
    k:containsInformationAbout-Focally ?TRIP.
  ?TRIP k:subEvents ?E.
  ?E a cal:Vevent } => { ?DOC cal:component ?E }.

{
  ?TZ a cal:Vtimezone.
  ?TZ2 a cal:Vtimezone.

  ?FLT
    k:startingDate [ dt:date ?YYMMDD];
    k:endingDate [ dt:date ?YYMMDD2];
    t:departureTime ?HH_MM;
    k:fromLocation [ k:inRegion ?TZ ];
    t:arrivalTime ?HH_MM2;
    k:toLocation [ k:inRegion ?TZ2 ].
  ?DTSTART is str:concatenation of
    (?YYMMDD "T" ?HH_MM ":00") . #@@ extra punct in dates
  ?DTEND is str:concatenation of
    (?YYMMDD2 "T" ?HH_MM2 ":00") .

}
 => {
  ?FLT a cal:Vevent;
    cal:dtstart [ ?TZ ?DTSTART ];
    cal:dtend [?TZ2 ?DTEND] .
}.


{ :FLT
    t:carrier [ k:nameOfAgent :CARRIER_NAME ];
    t:flightNumber :NUM;
    k:fromLocation [ k:nameString :FROM_NAME; ];
    k:toLocation [ k:nameString :TO_NAME; ].
  :SUM is str:concatenation of
    (:CARRIER_NAME " #" :NUM " from " :FROM_NAME " to " :TO_NAME).
}
 log:implies {
  :FLT cal:summary :SUM.
}.
